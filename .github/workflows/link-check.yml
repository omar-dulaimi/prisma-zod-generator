name: Link Check
on:
  schedule:
    - cron: '0 3 * * 1'
  workflow_dispatch:
jobs:
  link-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Use Node
        uses: actions/setup-node@v6
        with:
          node-version: 20
      - name: Install pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10.15.1
      - name: Install docs dependencies
        run: cd website && pnpm install --frozen-lockfile
      - name: Build docs
        run: cd website && pnpm run build
      - name: Check internal links
        run: |
          grep -Rho "/prisma-zod-generator[^"]*" website/build | sed 's/#.*//' | sort -u > links.txt
          missing=0
          while read -r p; do
            target="website/build${p#/prisma-zod-generator}"
            if [ ! -e "$target" ] && [ ! -e "$target/index.html" ]; then
              echo "Missing: $p"; missing=1; fi
          done < links.txt
          if [ "$missing" = "1" ]; then echo "Broken links detected"; exit 1; fi
